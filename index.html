<!DOCTYPE html>
<html lang="en">
<head>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CV & Cover Letter Generator</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&display=swap');
        
        :root {
            --primary-color: #2563eb;
            --secondary-color: #1e40af;
            --background-color: #f8fafc;
            --card-color: #ffffff;
            --text-color: #1e293b;
            --muted-color: #64748b;
            --success-color: #16a34a;
            --error-color: #dc2626;
        }

        body {
            font-family: 'Inter', sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 2rem;
            background-color: var(--background-color);
            color: var (--text-color);
            line-height: 1.6;
        }

        h1 {
            color: var(--primary-color);
            font-weight: 600;
            margin-bottom: 2rem;
            text-align: center;
        }

        .form-section {
            display: none;
            background: var(--card-color);
            padding: 2rem;
            border-radius: 12px;
            margin-bottom: 2rem;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            transition: opacity 0.3s ease;
        }

        .form-section.active {
            display: block;
            animation: fadeIn 0.3s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .progress-bar {
            display: flex;
            justify-content: space-between;
            margin: 2rem 0;
            position: relative;
            padding: 1rem 0;
        }

        .progress-bar::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 0;
            right: 0;
            height: 4px;
            background: #e2e8f0;
            z-index: 0;
            transform: translateY(-50%);
            border-radius: 2px;
        }

        .progress-bar::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 0;
            width: 0;
            height: 4px;
            background: var(--primary-color);
            z-index: 1;
            transform: translateY(-50%);
            border-radius: 2px;
            transition: width 0.4s ease;
        }

        .progress-step {
            display: flex;
            flex-direction: column;
            align-items: center;
            background: transparent;
            padding: 0.5rem;
            position: relative;
            z-index: 2;
            cursor: pointer;
        }

        .progress-step:hover .step-number {
            transform: scale(1.1);
            box-shadow: 0 0 0 4px rgba(37, 99, 235, 0.1);
        }

        .progress-step.active .step-number {
            background: var(--primary-color);
            color: white;
            transform: scale(1.2);
            box-shadow: 0 0 0 6px rgba(37, 99, 235, 0.2);
        }

        .progress-step.completed .step-number {
            background: var(--success-color);
            color: white;
        }

        .step-number {
            width: 2.5rem;
            height: 2.5rem;
            border-radius: 50%;
            background: #e2e8f0;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            margin-bottom: 0.75rem;
            transition: all 0.3s ease;
            position: relative;
            z-index: 2;
        }

        .step-label {
            font-size: 0.875rem;
            color: var(--muted-color);
            font-weight: 500;
            transition: color 0.3s ease;
        }

        .progress-step.active .step-label {
            color: var(--primary-color);
            font-weight: 600;
        }

        .progress-step.completed .step-label {
            color: var (--success-color);
        }

        textarea, input, button {
            width: 100%;
            padding: 0.75rem;
            margin: 0.75rem 0;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            font-family: inherit;
            font-size: 1rem;
            transition: all 0.2s ease;
        }

        textarea:focus, input:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
        }

        .nav-buttons {
            display: flex;
            justify-content: space-between;
            margin-top: 1.5rem;
        }

        .nav-btn {
            padding: 0.75rem 1.5rem;
            background-color: var(--primary-color);
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.2s ease;
        }

        .nav-btn:hover {
            background-color: var(--secondary-color);
            transform: translateY(-1px);
        }

        .nav-btn:disabled {
            background-color: #cbd5e1;
            cursor: not-allowed;
            transform: none;
        }

        .template-options {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1.5rem;
            margin: 1.5rem 0;
        }

        .template-card {
            border: 1px solid #e2e8f0;
            border-radius: 12px;
            padding: 1.5rem;
            cursor: pointer;
            text-align: center;
            transition: all 0.2s ease;
            background: var(--card-color);
        }

        .template-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        }

        .template-card.selected {
            border-color: var(--primary-color);
            background-color: rgba(37, 99, 235, 0.05);
        }

        .template-icon {
            font-size: 2rem;
            color: var(--primary-color);
            margin-bottom: 1rem;
        }

        .template-card h3 {
            color: var(--primary-color);
            margin-bottom: 0.5rem;
        }

        .template-card p {
            color: var(--muted-color);
            font-size: 0.875rem;
        }

        .preview-section {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1.5rem;
        }

        .output {
            background: var(--card-color);
            padding: 1.5rem;
            border: 1px solid #e2e8f0;
            border-radius: 12px;
            min-height: 400px;
            overflow-y: auto;
        }

        .output h3 {
            color: var(--primary-color);
            margin-bottom: 1rem;
        }

        .loading {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 200px;
        }

        .loading-spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid var(--primary-color);
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .analysis-section {
            background: var(--card-color);
            padding: 1.5rem;
            border: 1px solid #e2e8f0;
            border-radius: 12px;
            margin-top: 1rem;
            display: none;
        }

        .analysis-section h3 {
            color: var(--primary-color);
            margin-bottom: 1rem;
        }

        .analysis-item {
            margin-bottom: 0.75rem;
        }

        .analysis-item h4 {
            color: var(--text-color);
            font-weight: 500;
            margin-bottom: 0.25rem;
        }

        .analysis-item p {
            color: var(--muted-color);
            font-size: 0.875rem;
        }

        .interview-prep-section {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: var(--background-color);
            overflow-y: auto;
            z-index: 1000;
            padding: 2rem;
        }

        .interview-prep-section.active {
            display: block;
            animation: slideIn 0.3s ease;
        }

        .prep-category {
            margin-bottom: 2rem;
            padding: 1.5rem;
            background: var(--background-color);
            border-radius: 8px;
            transition: all 0.3s ease;
        }

        .prep-category:hover {
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            transform: translateY(-2px);
        }

        .interview-section-title {
            color: var(--primary-color);
            font-size: 1.5rem;
            margin-bottom: 1rem;
            border-bottom: 2px solid var(--primary-color);
            padding-bottom: 0.5rem;
        }

        .question-item {
            margin-bottom: 1.5rem;
            padding: 1.5rem;
            background: var(--card-color);
            border-radius: 8px;
            border-left: 4px solid var(--primary-color);
            transition: all 0.3s ease;
        }

        .question-item:hover {
            transform: translateX(5px);
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .answer-section {
            margin-top: 1rem;
            padding-top: 1rem;
            border-top: 1px dashed var(--muted-color);
        }

        .tips-section {
            background: rgba(37, 99, 235, 0.05);
            padding: 1rem;
            border-radius: 6px;
            margin-top: 1rem;
        }

        .tips-title {
            color: var(--primary-color);
            font-weight: 600;
            margin-bottom: 0.5rem;
        }

        .editable {
            border: 2px dashed var(--primary-color);
            padding: 1rem;
            background-color: rgba(37, 99, 235, 0.05);
        }

        .editable:focus {
            outline: none;
            border: 2px solid var(--primary-color);
            box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
        }

        .button-group {
            display: flex;
            gap: 0.5rem;
            margin-top: 1rem;
        }

        .email-section {
            margin-top: 2rem;
            padding: 2rem;
            background: var(--card-color);
            border-radius: 12px;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        }

        .email-output {
            background: var(--card-color);
            padding: 1.5rem;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            margin-top: 1rem;
            font-family: 'Inter', sans-serif;
        }

        .email-header {
            margin-bottom: 1rem;
            padding-bottom: 1rem;
            border-bottom: 1px solid #e2e8f0;
        }

        .email-field {
            margin-bottom: 0.5rem;
            color: var(--muted-color);
        }

        .email-body {
            white-space: pre-line;
            line-height: 1.6;
        }

        .floating-interview-btn {
            position: fixed;
            bottom: 2rem;
            right: 2rem;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
            box-shadow: 0 4px 15px rgba(37, 99, 235, 0.25);
            cursor: pointer;
            z-index: 999;
            border: none;
            display: none;
            align-items: center;
            justify-content: center;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            font-size: 1.5rem;
        }

        .floating-interview-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(37, 99, 235, 0.3);
        }

        .floating-interview-btn.active {
            background: var(--secondary-color);
            transform: scale(0.95);
        }

        .ai-notification {
            position: fixed;
            bottom: 5rem;
            right: 2rem;
            background: var(--card-color);
            padding: 1rem;
            border-radius: 12px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            width: 250px;
            z-index: 998;
            opacity: 0;
            transform: translateY(20px);
            pointer-events: none;
            transition: all 0.3s ease;
        }

        .ai-notification.show {
            opacity: 1;
            transform: translateY(0);
        }

        .ai-notification-content {
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .ai-notification-icon {
            background: rgba(37, 99, 235, 0.1);
            width: 40px;
            height: 40px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.25rem;
        }

        .ai-notification-text {
            flex: 1;
        }

        .ai-notification-title {
            font-weight: 600;
            color: var(--text-color);
            font-size: 0.95rem;
            margin-bottom: 0.25rem;
        }

        .ai-notification-desc {
            color: var(--muted-color);
            font-size: 0.85rem;
        }

        .pulse-ring {
            position: absolute;
            inset: -4px;
            border-radius: 50%;
            border: 2px solid var(--primary-color);
            opacity: 0;
            transform: scale(1.1);
        }

        @keyframes pulseRing {
            0% { transform: scale(1.1); opacity: 0; }
            50% { opacity: 0.5; }
            100% { transform: scale(1.5); opacity: 0; }
        }

        .floating-interview-btn.pulse .pulse-ring {
            animation: pulseRing 2s cubic-bezier(0.455, 0.03, 0.515, 0.955) infinite;
        }

        .chat-container {
            display: flex;
            flex-direction: column;
            height: 100%;
            max-width: 800px;
            margin: 0 auto;
        }

        .chat-messages {
            flex-grow: 1;
            overflow-y: auto;
            padding: 1rem;
            margin-bottom: 1rem;
        }

        .chat-message {
            margin-bottom: 1rem;
            opacity: 0;
            transform: translateY(20px);
            animation: fadeInUp 0.3s forwards;
        }

        @keyframes fadeInUp {
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .bot-message, .user-message {
            max-width: 80%;
            padding: 1rem;
            border-radius: 1rem;
            margin-bottom: 0.5rem;
        }

        .bot-message {
            background: var(--primary-color);
            color: white;
            margin-right: auto;
            border-bottom-left-radius: 0.25rem;
        }

        .user-message {
            background: var(--card-color);
            border: 1px solid var(--primary-color);
            margin-left: auto;
            border-bottom-right-radius: 0.25rem;
        }

        .chat-input {
            display: flex;
            gap: 0.5rem;
            padding: 1rem;
            background: var(--card-color);
            border-top: 1px solid #e2e8f0;
            position: sticky;
            bottom: 0;
        }

        .chat-input input {
            flex-grow: 1;
            margin: 0;
        }

        .chat-input button {
            width: auto;
            margin: 0;
        }

        .options-container {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
            margin-top: 0.5rem;
        }

        .option-button {
            background: var(--card-color);
            border: 1px solid var(--primary-color);
            color: var(--primary-color);
            padding: 0.5rem 1rem;
            border-radius: 1rem;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .option-button:hover {
            background: var(--primary-color);
            color: white;
        }

        .role-select {
            display: flex;
            gap: 1rem;
            margin-bottom: 1rem;
        }

        .role-btn {
            flex: 1;
            padding: 1rem;
            border: 2px solid var(--primary-color);
            border-radius: 8px;
            background: var(--card-color);
            color: var(--primary-color);
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .role-btn.active {
            background: var(--primary-color);
            color: white;
        }

        .bot-message .feedback {
            margin-top: 0.5rem;
            padding-top: 0.5rem;
            border-top: 1px dashed rgba(255, 255, 255, 0.3);
            font-size: 0.9em;
            opacity: 0.9;
        }

        .typing-indicator {
            padding: 0.5rem;
            display: inline-block;
            font-style: italic;
            color: var(--muted-color);
        }

        /* New styles */
        .chat-container {
            display: flex;
            flex-direction: column;
            height: calc(100vh - 100px);
            max-width: 900px;
            margin: 0 auto;
            background: #f8fafc;
            border-radius: 16px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            overflow: hidden;
        }

        .chat-header {
            padding: 1.5rem;
            background: var(--primary-color);
            color: white;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .chat-header h2 {
            margin: 0;
            font-size: 1.25rem;
        }

        .chat-header p {
            margin: 0.5rem 0 0;
            opacity: 0.9;
            font-size: 0.9rem;
        }

        .chat-messages {
            flex-grow: 1;
            padding: 1.5rem;
            overflow-y: auto;
            background: #ffffff;
        }

        .chat-message {
            margin-bottom: 1.5rem;
            opacity: 0;
            transform: translateY(20px);
            animation: fadeInUp 0.3s forwards;
        }

        .bot-message, .user-message {
            max-width: 85%;
            padding: 1rem 1.25rem;
            border-radius: 1.5rem;
            line-height: 1.5;
            position: relative;
        }

        .bot-message {
            background: var(--primary-color);
            color: white;
            margin-right: auto;
            border-bottom-left-radius: 0.25rem;
        }

        .user-message {
            background: #f1f5f9;
            color: var(--text-color);
            margin-left: auto;
            border-bottom-right-radius: 0.25rem;
        }

        .chat-input-container {
            padding: 1.25rem;
            background: white;
            border-top: 1px solid #e2e8f0;
        }

        .chat-input {
            display: flex;
            gap: 0.75rem;
            padding: 0.5rem;
            background: #f8fafc;
            border-radius: 12px;
        }

        .chat-input input {
            flex-grow: 1;
            margin: 0;
            padding: 0.75rem 1rem;
            border: none;
            background: transparent;
            font-size: 1rem;
        }

        .chat-input input:focus {
            outline: none;
            box-shadow: none;
        }

        .chat-input button {
            padding: 0.75rem 1.5rem;
            margin: 0;
            border-radius: 8px;
            font-weight: 500;
        }

        .options-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 0.75rem;
            margin-top: 1rem;
        }

        .option-button {
            padding: 0.75rem 1rem;
            border-radius: 8px;
            font-size: 0.95rem;
            transition: all 0.2s ease;
        }

        .typing-indicator {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.5rem 1rem;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 1rem;
            font-size: 0.9rem;
            margin-top: 0.5rem;
        }

        .typing-dots {
            display: flex;
            gap: 0.25rem;
        }

        .typing-dot {
            width: 6px;
            height: 6px;
            background: white;
            border-radius: 50%;
            opacity: 0.7;
            animation: typingDot 1.4s infinite;
        }

        .typing-dot:nth-child(2) { animation-delay: 0.2s; }
        .typing-dot:nth-child(3) { animation-delay: 0.4s; }

        @keyframes typingDot {
            0%, 60%, 100% { transform: translateY(0); }
            30% { transform: translateY(-4px); }
        }

        /* Add these new styles */
        .auth-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }

        .auth-container {
            background: var(--card-color);
            padding: 2rem;
            border-radius: 12px;
            width: 100%;
            max-width: 400px;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        }

        .auth-tabs {
            display: flex;
            margin-bottom: 1.5rem;
            border-bottom: 2px solid #e2e8f0;
        }

        .auth-tab {
            padding: 0.75rem 1.5rem;
            cursor: pointer;
            color: var(--muted-color);
            font-weight: 500;
            transition: all 0.2s ease;
        }

        .auth-tab.active {
            color: var(--primary-color);
            border-bottom: 2px solid var(--primary-color);
            margin-bottom: -2px;
        }

        .auth-form {
            display: none;
        }

        .auth-form.active {
            display: block;
        }

        .error-message {
            color: var(--error-color);
            font-size: 0.875rem;
            margin-top: 0.5rem;
            display: none;
        }

        .auth-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1rem 2rem;
            background: var(--card-color);
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .logout-btn {
            position: fixed;
            top: 1rem;
            right: 1rem;
            width: 40px;
            height: 40px;
            padding: 0;
            margin: 0;
            border-radius: 50%;
            background: var(--card-color);
            border: 2px solid var(--primary-color);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
            z-index: 9999;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }

        .logout-btn:hover {
            background: var(--primary-color);
            transform: scale(1.1);
            box-shadow: 0 4px 12px rgba(37, 99, 235, 0.2);
        }

        .logout-btn svg {
            width: 18px;
            height: 18px;
            color: var(--primary-color);
            transition: color 0.3s ease;
        }

        .logout-btn:hover svg {
            color: white;
        }

        .logout-btn .tooltip {
            position: absolute;
            right: 100%;
            top: 50%;
            transform: translateY(-50%);
            background: var(--text-color);
            color: white;
            padding: 0.4rem 0.8rem;
            border-radius: 4px;
            font-size: 0.75rem;
            margin-right: 8px;
            opacity: 0;
            visibility: hidden;
            transition: all 0.2s ease;
            white-space: nowrap;
        }

        .logout-btn:hover .tooltip {
            opacity: 1;
            visibility: visible;
            margin-right: 10px;
        }

        /* Updated auth styles */
        .auth-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(rgba(37, 99, 235, 0.1), rgba(30, 64, 175, 0.2));
            backdrop-filter: blur(8px);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }

        .auth-container {
            background: var(--card-color);
            padding: 2.5rem;
            border-radius: 16px;
            width: 100%;
            max-width: 420px;
            box-shadow: 0 8px 30px rgba(0, 0, 0, 0.12);
            animation: slideUp 0.4s ease;
            display: flex;
            flex-direction: column;
            align-items: center;  /* Center horizontally */
        }

        @keyframes slideUp {
            from { transform: translateY(20px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        .auth-header {
            text-align: center;
            margin-bottom: 2rem;
            width: 100%;
        }

        .auth-header h1 {
            font-size: 1.75rem;
            color: var(--primary-color);
            margin-bottom: 0.5rem;
        }

        .auth-header p {
            color: var(--muted-color);
            font-size: 0.95rem;
        }

        .auth-tabs {
            width: 100%;
            display: flex;
            justify-content: center;
            background: var(--background-color);
            padding: 0.25rem;
            border-radius: 12px;
            margin-bottom: 2rem;
        }

        .auth-tab {
            flex: 1;
            padding: 0.75rem;
            text-align: center;
            cursor: pointer;
            border-radius: 8px;
            font-weight: 500;
            transition: all 0.3s ease;
        }

        .auth-tab.active {
            background: var(--primary-color);
            color: white;
            box-shadow: 0 2px 8px rgba(37, 99, 235, 0.25);
        }

        .auth-form {
            width: 100%;
            max-width: 320px;  /* Limit the form width */
            margin: 0 auto;    /* Center the form */
            display: none;
        }

        .auth-form.active {
            display: flex;
            flex-direction: column;
            align-items: center;
            animation: fadeIn 0.3s ease;
        }

        .input-group {
            position: relative;
            margin-bottom: 1.5rem;
            width: 100%;      /* Make inputs full width of the form */
        }

        .input-group input {
            width: 100%;
            padding: 1rem;
            padding-left: 3rem;
            background: var(--background-color);
            border: 2px solid transparent;
            border-radius: 12px;
            font-size: 1rem;
            transition: all 0.3s ease;
        }

        .input-group input:focus {
            border-color: var(--primary-color);
            background: white;
            box-shadow: 0 0 0 4px rgba(37, 99, 235, 0.1);
        }

        .input-group svg {
            position: absolute;
            left: 1rem;
            top: 50%;
            transform: translateY(-50%);
            width: 20px;
            height: 20px;
            color: var(--muted-color);
            transition: color 0.3s ease;
        }

        .input-group input:focus + svg {
            color: var(--primary-color);
        }

        .auth-btn {
            width: 100%;      /* Make button full width of the form */
            max-width: 320px; /* Match input width */
            margin-top: 1.5rem;
            padding: 1rem;
            background: var(--primary-color);
            color: white;
            border: none;
            border-radius: 12px;
            font-size: 1rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .auth-btn:hover {
            background: var(--secondary-color);
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(37, 99, 235, 0.25);
        }

        .auth-separator {
            display: flex;
            align-items: center;
            text-align: center;
            margin: 1.5rem 0;
            color: var(--muted-color);
        }

        .auth-separator::before,
        .auth-separator::after {
            content: '';
            flex: 1;
            border-bottom: 1px solid #e2e8f0;
        }

        .auth-separator span {
            padding: 0 1rem;
            font-size: 0.9rem;
        }

        .error-message {
            background: #fef2f2;
            color: #dc2626;
            padding: 0.75rem 1rem;
            border-radius: 8px;
            font-size: 0.9rem;
            margin-top: 0.5rem;
            display: none;
        }

        .error-message.show {
            display: block;
            animation: shake 0.5s ease;
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            75% { transform: translateX(5px); }
        }

        .tos-group {
            width: 100%;
            margin: 1rem 0;
            text-align: center;
            font-size: 0.9rem;
            color: var(--muted-color);
        }

        .tos-group label {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            cursor: pointer;
        }

        .tos-group input[type="checkbox"] {
            width: auto;
            margin: 0;
            cursor: pointer;
        }

        .password-strength {
            width: 100%;
            text-align: center;
            font-size: 0.8rem;
            margin-top: 0.25rem;
            color: var(--muted-color);
        }

        .password-strength.weak { color: var(--error-color); }
        .password-strength.medium { color: #f59e0b; }
        .password-strength.strong { color: var(--success-color); }

        .input-group.error input {
            border-color: var(--error-color);
        }

        .input-feedback {
            font-size: 0.8rem;
            margin-top: 0.25rem;
            color: var(--error-color);
        }

        /* Add smooth transitions for better UX */
        .auth-form.active > * {
            animation: slideUpFade 0.3s ease forwards;
            opacity: 0;
            transform: translateY(10px);
        }

        @keyframes slideUpFade {
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Add staggered animation delays for form elements */
        .auth-form.active .input-group:nth-child(1) { animation-delay: 0.1s; }
        .auth-form.active .input-group:nth-child(2) { animation-delay: 0.2s; }
        .auth-form.active .input-group:nth-child(3) { animation-delay: 0.3s; }
        .auth-form.active .input-group:nth-child(4) { animation-delay: 0.4s; }
        .auth-form.active .tos-group { animation-delay: 0.5s; }
        .auth-form.active .auth-btn { animation-delay: 0.6s; }
    </style>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.4.120/pdf.min.js" integrity="sha512-ml/QKfG3+Yes6TwOzQb7aCNtJF4PUyha6R3w8pSTo/VJSywl7ZreYvvtUso7fKevpsI+pYVVwnu82YO0q3V6eg==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <script>
        // Configure PDF.js worker
        pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.4.120/pdf.worker.min.js';
    </script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script>
        // Add this global function before any other scripts
        function switchTab(tab) {
            document.querySelectorAll('.auth-tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.auth-form').forEach(f => f.classList.remove('active'));
            
            document.querySelector(`.auth-tab:${tab === 'login' ? 'first-child' : 'last-child'}`).classList.add('active');
            document.getElementById(`${tab}Form`).classList.add('active');
        }
    </script>
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.0/firebase-app.js";
        import { 
            getAuth, 
            signInWithEmailAndPassword,
            createUserWithEmailAndPassword,
            signOut,
            onAuthStateChanged
        } from "https://www.gstatic.com/firebasejs/10.7.0/firebase-auth.js";

        // Your web app's Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyAO4CdS6VAgvCPfqujrJTM386DD-cFnPo8",
            authDomain: "cvtailor-firebase-ai-app.firebaseapp.com",
            projectId: "cvtailor-firebase-ai-app",
            storageBucket: "cvtailor-firebase-ai-app.firebasestorage.app",
            messagingSenderId: "893222305408",
            appId: "1:893222305408:web:e854a2e31a860a4542f065"
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);

        // Auth state observer
        onAuthStateChanged(auth, (user) => {
            if (user) {
                console.log('User is signed in:', user.email);
                document.getElementById('authOverlay').style.display = 'none';
                document.getElementById('logoutBtn').style.display = 'flex'; // Changed from 'block' to 'flex'
            } else {
                console.log('User is signed out');
                document.getElementById('authOverlay').style.display = 'flex';
                document.getElementById('logoutBtn').style.display = 'none';
            }
        });

        // Make auth functions globally available
        window.handleLogin = async (event) => {
            event.preventDefault();
            const email = document.getElementById('loginEmail').value;
            const password = document.getElementById('loginPassword').value;
            const errorElement = document.getElementById('loginError');
            
            try {
                const userCredential = await signInWithEmailAndPassword(auth, email, password);
                console.log('Login successful:', userCredential.user.email);
                errorElement.style.display = 'none';
            } catch (error) {
                console.error('Login error:', error);
                errorElement.style.display = 'block';
                errorElement.textContent = error.message;
            }
        };

        window.handleSignup = async (event) => {
            event.preventDefault();
            const email = document.getElementById('signupEmail').value;
            const password = document.getElementById('signupPassword').value;
            const errorElement = document.getElementById('signupError');
            
            try {
                const userCredential = await createUserWithEmailAndPassword(auth, email, password);
                console.log('Signup successful:', userCredential.user.email);
                errorElement.style.display = 'none';
            } catch (error) {
                console.error('Signup error:', error);
                errorElement.style.display = 'block';
                errorElement.textContent = error.message;
            }
        };

        window.handleLogout = async () => {
            try {
                await signOut(auth);
                console.log('Logout successful');
                window.location.reload(); // Add this line to refresh the page
            } catch (error) {
                console.error('Logout error:', error);
                alert('Error logging out: ' + error.message);
            }
        };

        // Initialize event listeners
        document.addEventListener('DOMContentLoaded', () => {
            document.getElementById('logoutBtn').addEventListener('click', window.handleLogout);
        });
    </script>
    <script>
        // ...existing code...
        
        // Add these constants at the top with your other constants
        const MAX_RETRIES = 3;
        const RETRY_DELAY = 1000; // 1 second
        const BACKUP_API_KEY = 'YOUR_BACKUP_API_KEY'; // Consider adding a backup key

        // Add this new utility function
        async function retryableApiCall(endpoint, payload, retries = MAX_RETRIES) {
            const apiUrl = 'https://generativelanguage.googleapis.com/v1beta/models/gemini-pro:generateContent';
            
            for (let attempt = 1; attempt <= retries; attempt++) {
                try {
                    const response = await fetch(`${apiUrl}?key=${GEMINI_API_KEY}`, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify(payload)
                    });

                    if (response.status === 429) { // Rate limit error
                        const waitTime = RETRY_DELAY * attempt;
                        console.log(`Rate limited, waiting ${waitTime}ms before retry ${attempt}`);
                        await new Promise(resolve => setTimeout(resolve, waitTime));
                        continue;
                    }

                    if (!response.ok) {
                        const errorData = await response.json();
                        throw new Error(errorData.error?.message || response.statusText);
                    }

                    return await response.json();
                } catch (error) {
                    if (attempt === retries) throw error;
                    console.log(`Attempt ${attempt} failed, retrying...`);
                    await new Promise(resolve => setTimeout(resolve, RETRY_DELAY));
                }
            }
        }

        // Update the generateDocument function to use the new retry logic
        async function generateDocument() {
            const fileInput = document.getElementById('cvUpload');
            if (!fileInput.files.length) {
                alert('Please upload and analyze your CV first');
                return;
            }
            
            document.getElementById('cvOutput').innerHTML = '<div class="loading"><div class="loading-spinner"></div></div>';
            document.getElementById('coverLetterOutput').innerHTML = '<div class="loading"><div class="loading-spinner"></div></div>';

            try {
                const file = fileInput.files[0];
                cvContent = await extractTextFromPDF(file);

                if (!jobDescription || !selectedTemplate) {
                    alert('Please enter the job description and select a template');
                    return;
                }

                // Generate CV using the same format as the email generation
                const cvResponse = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-pro:generateContent?key=${GEMINI_API_KEY}`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        contents: [{
                            parts: [{
                                text: `Generate a professional CV based on this content. The CV should have these exact sections in order:
                                    1. Header with name and contact information
                                    2. Professional summary
                                    3. Work experience (company, position, dates, and bullet points of achievements)
                                    4. Education
                                    5. Skills
                                    6. Certifications (if any)

                                    Format using HTML tags:
                                    - Use <h2> for section headers
                                    - Use <ul> and <li> for lists
                                    - Use <p> for paragraphs
                                    - Use <strong> for emphasis

                                    Source CV Content: ${cvContent}
                                    Job Description to target: ${jobDescription}

                                    Make it professional, ATS-friendly, and focused on relevant achievements.`
                            }]
                        }]
                    })
                });

                if (!cvResponse.ok) {
                    throw new Error('Failed to generate CV');
                }

                // Generate Cover Letter using the same format
                const coverLetterResponse = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-pro:generateContent?key=${GEMINI_API_KEY}`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        contents: [{
                            parts: [{
                                text: `Generate a professional cover letter following this format:
                                    1. Current date
                                    2. Recipient's address block
                                    3. Professional salutation
                                    4. Opening paragraph introducing yourself and position
                                    5. Body paragraphs highlighting relevant experience
                                    6. Closing paragraph with call to action
                                    7. Professional closing

                                    Use these guidelines:
                                    - Format with <p> tags for paragraphs
                                    - Use <br> for address blocks
                                    - Keep tone professional but engaging
                                    - Focus on relevant experience and value proposition

                                    CV Content: ${cvContent}
                                    Job Description: ${jobDescription}

                                    Make it compelling and tailored to the position.`
                            }]
                        }]
                    })
                });

                if (!coverLetterResponse.ok) {
                    throw new Error('Failed to generate cover letter');
                }

                const cvData = await cvResponse.json();
                const coverLetterData = await coverLetterResponse.json();

                const cleanCvContent = cvData?.candidates?.[0]?.content?.parts?.[0]?.text || 'Failed to generate CV';
                const cleanCoverLetterContent = coverLetterData?.candidates?.[0]?.content?.parts?.[0]?.text || 'Failed to generate cover letter';

                document.getElementById('cvOutput').innerHTML = cleanCvContent;
                document.getElementById('coverLetterOutput').innerHTML = cleanCoverLetterContent;

                // Generate analysis for both documents
                await analyzeDocument('cv', cleanCvContent);
                await analyzeDocument('coverLetter', cleanCoverLetterContent);

                // Show analysis sections
                document.getElementById('cvAnalysis').style.display = 'block';
                document.getElementById('coverLetterAnalysis').style.display = 'block';

                // Show interview prep elements
                const interviewBtn = document.querySelector('.floating-interview-btn');
                const notification = document.getElementById('aiNotification');
                
                if (interviewBtn && notification) {
                    interviewBtn.style.display = 'flex';
                    interviewBtn.classList.add('show', 'pulse');
                    
                    setTimeout(() => {
                        notification.classList.add('show');
                        setTimeout(() => {
                            notification.classList.remove('show');
                            interviewBtn.classList.remove('pulse');
                        }, 3000);
                    }, 500);
                }

                // Generate email
                await generateEmail();

            } catch (error) {
                console.error('Error:', error);
                document.getElementById('cvOutput').innerHTML = 'Error generating CV: ' + error.message;
                document.getElementById('coverLetterOutput').innerHTML = 'Error generating cover letter: ' + error.message;
            }
        }
    </script>
</head>
<body>
    <div class="auth-header">
        <h1>CV & Cover Letter Generator</h1>
    </div>
    <button id="logoutBtn" class="logout-btn" onclick="handleLogout()" title="Logout">
        <span class="tooltip">Logout</span>
        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1" />
        </svg>
    </button>

    <!-- Progress Bar -->
    <div class="progress-bar">
        <div class="progress-step active" data-step="1">
            <div class="step-number">1</div>
            <div class="step-label">Upload CV</div>
        </div>
        <div class="progress-step" data-step="2">
            <div class="step-number">2</div>
            <div class="step-label">Job Details</div>
        </div>
        <div class="progress-step" data-step="3">
            <div class="step-number">3</div>
            <div class="step-label">Template</div>
        </div>
        <div class="progress-step" data-step="4">
            <div class="step-number">4</div>
            <div class="step-label">Preview</div>
        </div>
    </div>

    <!-- CV Upload Section -->
    <div id="cvUploadSection" class="form-section active" data-step="1">
        <h2>Upload Your CV</h2>
        <input type="file" id="cvUpload" accept="application/pdf">
        <div class="nav-buttons">
            <button class="nav-btn" id="nextToJobDesc" onclick="showSection('jobDescSection')">Next</button>
        </div>
    </div>

    <!-- Job Description Section -->
    <div id="jobDescSection" class="form-section">
        <h2>Job Description</h2>
        <textarea id="jobDescription" placeholder="Paste the job description here..." rows="10"></textarea>
        <div class="nav-buttons">
            <button class="nav-btn" onclick="showSection('cvUploadSection')">Back</button>
            <button class="nav-btn" id="nextToTemplate" onclick="showSection('templateSection')">Next</button>
        </div>
    </div>

    <!-- Template Selection Section -->
    <div id="templateSection" class="form-section">
        <h2>Select Template</h2>
        <div class="template-options">
            <div class="template-card" onclick="selectTemplate(1)">
                <div class="template-icon">📄</div>
                <h3>Professional</h3>
                <p>Clean and modern design</p>
            </div>
            <div class="template-card" onclick="selectTemplate(2)">
                <div class="template-icon">🎨</div>
                <h3>Creative</h3>
                <p>Modern with creative elements</p>
            </div>
            <div class="template-card" onclick="selectTemplate(3)">
                <div class="template-icon">🏛️</div>
                <h3>Classic</h3>
                <p>Traditional and formal style</p>
            </div>
        </div>
        <div class="nav-buttons">
            <button class="nav-btn" onclick="showSection('jobDescSection')">Back</button>
            <button class="nav-btn" id="generateBtn" onclick="showSection('previewSection'); generateDocument()" disabled>Generate</button>
        </div>
    </div>

    <!-- Preview Section -->
    <div id="previewSection" class="form-section">
        <h2>Generated Documents</h2>
        <div class="preview-section">
            <div>
                <h3>CV</h3>
                <div id="cvOutput" class="output">
                    <div class="loading">
                        <div class="loading-spinner"></div>
                    </div>
                </div>
                <div class="button-group">
                    <button class="nav-btn" onclick="regenerateCv()">Regenerate CV</button>
                    <button class="nav-btn" onclick="downloadDocument('cvOutput', 'cv.html')">Download CV</button>
                    <button class="nav-btn" onclick="toggleEdit('cvOutput')">Edit CV</button>
                </div>
                <div id="cvAnalysis" class="analysis-section" style="display: none;">
                    <h3>CV Strength Analysis</h3>
                    <div id="cvAnalysisContent"></div>
                </div>
            </div>
            <div>
                <h3>Cover Letter</h3>
                <div id="coverLetterOutput" class="output">
                    <div class="loading">
                        <div class="loading-spinner"></div>
                    </div>
                </div>
                <div class="button-group">
                    <button class="nav-btn" onclick="regenerateCoverLetter()">Regenerate Cover Letter</button>
                    <button class="nav-btn" onclick="downloadDocument('coverLetterOutput', 'cover_letter.html')">Download Cover Letter</button>
                    <button class="nav-btn" onclick="toggleEdit('coverLetterOutput')">Edit Cover Letter</button>
                </div>
                <div id="coverLetterAnalysis" class="analysis-section" style="display: none;">
                    <h3>Cover Letter Strength Analysis</h3>
                    <div id="coverLetterAnalysisContent"></div>
                </div>
            </div>
        </div>
        
        <!-- Add this section inside the preview-section div, after the interview-prep-section -->
        <div class="email-section">
            <h2 class="interview-section-title">Outreach Email</h2>
            <div id="emailOutput" class="email-output">
                <div class="loading">
                    <div class="loading-spinner"></div>
                </div>
            </div>
            <div class="button-group">
                <button class="nav-btn" onclick="regenerateEmail()">Regenerate Email</button>
                <button class="nav-btn" onclick="copyEmail()">Copy Email</button>
                <button class="nav-btn" onclick="toggleEdit('emailOutput')">Edit Email</button>
            </div>
        </div>
        
        <div class="nav-buttons">
            <button class="nav-btn" onclick="showSection('templateSection')">Back</button>
        </div>
    </div>

    <!-- Move the interview prep section outside the preview section and to the bottom of the body -->
    <div class="interview-prep-section">
        <button class="close-interview-btn" onclick="toggleInterviewPrep()">Close</button>
        <div class="chat-container">
            <div class="chat-header">
                <h2>Interview Coach</h2>
                <p>Practice your interview with AI-powered feedback</p>
            </div>
            <div class="role-select">
                <button class="role-btn active" onclick="setInterviewMode('practice')">Practice Interview</button>
                <button class="role-btn" onclick="setInterviewMode('feedback')">Get Feedback</button>
            </div>
            <div class="chat-messages" id="chatMessages">
                <div class="chat-message">
                    <div class="bot-message">
                        Welcome! I'll be your interview coach today. I've reviewed your CV and the job description, and I'm ready to help you prepare for your interview. Would you like to:
                        <div class="options-container">
                            <button class="option-button" onclick="startInterview('full')">Start Full Interview</button>
                            <button class="option-button" onclick="selectTopic('technical')">Practice Technical Questions</button>
                            <button class="option-button" onclick="selectTopic('behavioral')">Practice Behavioral Questions</button>
                            <button class="option-button" onclick="selectTopic('situational')">Practice Situational Questions</button>
                        </div>
                    </div>
                </div>
            </div>
            <div class="chat-input-container">
                <div class="chat-input">
                    <input type="text" id="userInput" placeholder="Type your response here..." onkeypress="handleKeyPress(event)">
                    <button class="nav-btn" onclick="sendMessage()">Send</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Add the floating button -->
    <button class="floating-interview-btn" onclick="toggleInterviewPrep()" title="AI Interview Coach">
        🤖
        <div class="pulse-ring"></div>
    </button>

    <div class="ai-notification" id="aiNotification">
        <div class="ai-notification-content">
            <div class="ai-notification-icon">🎯</div>
            <div class="ai-notification-text">
                <div class="ai-notification-title">AI Interview Coach Ready!</div>
                <div class="ai-notification-desc">Click the icon to practice your interview skills</div>
            </div>
        </div>
    </div>

    <script>
        function downloadDocument(elementId, filename) {
            const { jsPDF } = window.jspdf;
            const element = document.getElementById(elementId);
            
            // If the document is in edit mode, save it first
            if (element.contentEditable === 'true') {
                toggleEdit(elementId);
            }

            // Configure html2canvas with optimized settings
            const canvasOptions = {
                scale: 1.5, // Reduced from 2 to 1.5 for better file size
                useCORS: true,
                logging: false,
                allowTaint: true,
                backgroundColor: '#ffffff'
            };

            html2canvas(element, canvasOptions).then(canvas => {
                // Optimize canvas
                const optimizedCanvas = document.createElement('canvas');
                const ctx = optimizedCanvas.getContext('2d');
                
                // Set smaller dimensions while maintaining aspect ratio
                const maxWidth = 1240; // Reduced maximum width
                const scaleFactor = maxWidth / canvas.width;
                optimizedCanvas.width = maxWidth;
                optimizedCanvas.height = canvas.height * scaleFactor;
                
                // Draw with smoothing
                ctx.imageSmoothingEnabled = true;
                ctx.imageSmoothingQuality = 'high';
                ctx.drawImage(canvas, 0, 0, optimizedCanvas.width, optimizedCanvas.height);

                // Get optimized image data with reduced quality
                const imgData = optimizedCanvas.toDataURL('image/jpeg', 0.75); // Using JPEG with 75% quality

                // Create PDF with optimized settings
                const pdf = new jsPDF({
                    orientation: 'p',
                    unit: 'mm',
                    format: 'a4',
                    compress: true
                });

                const pdfWidth = pdf.internal.pageSize.getWidth();
                const pdfHeight = pdf.internal.pageSize.getHeight();
                const imgProps = pdf.getImageProperties(imgData);
                const ratio = Math.min(pdfWidth / imgProps.width, pdfHeight / imgProps.height) * 0.95; // Slightly reduced ratio

                const width = imgProps.width * ratio;
                const height = imgProps.height * ratio;
                const x = (pdfWidth - width) / 2;
                const y = (pdfHeight - height) / 2;

                // Add image with compression
                pdf.addImage({
                    imageData: imgData,
                    x: x,
                    y: y,
                    width: width,
                    height: height,
                    compression: 'JPEG',
                    quality: 0.75
                });

                // Save with optimization
                const pdfOptions = {
                    compress: true,
                    precision: 4,
                    optimization: {
                        compress: true,
                        compressLevel: 9
                    }
                };

                pdf.save(filename.replace('.html', '.pdf'), pdfOptions);
            }).catch(error => {
                console.error('Error generating PDF:', error);
                alert('Error generating PDF. Please try again.');
            });
        }
    </script>

    <script>
        let cvContent = '';
        let jobDescription = '';
        let selectedTemplate = null;
        let keywords;
        let matchedKeywords;
        let keywordMatchScore;
        let jobDescriptionWords;
        let personalizedWords;
        let personalizationScore;
        let atsCompatibilityScore;
        let currentStep = 1;
        const GEMINI_API_KEY = 'AIzaSyB5GNmttJhM2HXwRTQLhpl9C1SIhCxX04o';

        async function extractTextFromPDF(file) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.onload = async function() {
                    try {
                        const typedarray = new Uint8Array(this.result);
                        const pdf = await pdfjsLib.getDocument(typedarray).promise;
                        let fullText = '';

                        for (let i = 1; i <= pdf.numPages; i++) {
                            const page = await pdf.getPage(i);
                            const textContent = await page.getTextContent();
                            
                            fullText += textContent.items.map(item => item.str).join(' ');
                        }
                        resolve(fullText);
                    } catch (error) {
                        reject(error);
                    }
                };
                reader.onerror = reject;
                reader.readAsArrayBuffer(file);
            });
        }

        function selectTemplate(templateId) {
            document.querySelectorAll('.template-card').forEach(card => {
                card.classList.remove('selected');
            });
            document.querySelector(`.template-card:nth-child(${templateId})`).classList.add('selected');
            selectedTemplate = templateId;
            document.getElementById('generateBtn').disabled = false;
        }

        async function generateDocument() {
            const fileInput = document.getElementById('cvUpload');
            if (!fileInput.files.length) {
                alert('Please upload and analyze your CV first');
                return;
            }
            
            document.getElementById('cvOutput').innerHTML = '<div class="loading"><div class="loading-spinner"></div></div>';
            document.getElementById('coverLetterOutput').innerHTML = '<div class="loading"><div class="loading-spinner"></div></div>';

            try {
                const file = fileInput.files[0];
                cvContent = await extractTextFromPDF(file);

                if (!jobDescription || !selectedTemplate) {
                    alert('Please enter the job description and select a template');
                    return;
                }

                // Generate CV using the same format as the email generation
                const cvResponse = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-pro:generateContent?key=${GEMINI_API_KEY}`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        contents: [{
                            parts: [{
                                text: `Generate a professional CV based on this content. The CV should have these exact sections in order:
                                    1. Header with name and contact information
                                    2. Professional summary
                                    3. Work experience (company, position, dates, and bullet points of achievements)
                                    4. Education
                                    5. Skills
                                    6. Certifications (if any)

                                    Format using HTML tags:
                                    - Use <h2> for section headers
                                    - Use <ul> and <li> for lists
                                    - Use <p> for paragraphs
                                    - Use <strong> for emphasis

                                    Source CV Content: ${cvContent}
                                    Job Description to target: ${jobDescription}

                                    Make it professional, ATS-friendly, and focused on relevant achievements.`
                            }]
                        }]
                    })
                });

                if (!cvResponse.ok) {
                    throw new Error('Failed to generate CV');
                }

                // Generate Cover Letter using the same format
                const coverLetterResponse = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-pro:generateContent?key=${GEMINI_API_KEY}`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        contents: [{
                            parts: [{
                                text: `Generate a professional cover letter following this format:
                                    1. Current date
                                    2. Recipient's address block
                                    3. Professional salutation
                                    4. Opening paragraph introducing yourself and position
                                    5. Body paragraphs highlighting relevant experience
                                    6. Closing paragraph with call to action
                                    7. Professional closing

                                    Use these guidelines:
                                    - Format with <p> tags for paragraphs
                                    - Use <br> for address blocks
                                    - Keep tone professional but engaging
                                    - Focus on relevant experience and value proposition

                                    CV Content: ${cvContent}
                                    Job Description: ${jobDescription}

                                    Make it compelling and tailored to the position.`
                            }]
                        }]
                    })
                });

                if (!coverLetterResponse.ok) {
                    throw new Error('Failed to generate cover letter');
                }

                const cvData = await cvResponse.json();
                const coverLetterData = await coverLetterResponse.json();

                const cleanCvContent = cvData?.candidates?.[0]?.content?.parts?.[0]?.text || 'Failed to generate CV';
                const cleanCoverLetterContent = coverLetterData?.candidates?.[0]?.content?.parts?.[0]?.text || 'Failed to generate cover letter';

                document.getElementById('cvOutput').innerHTML = cleanCvContent;
                document.getElementById('coverLetterOutput').innerHTML = cleanCoverLetterContent;

                // Generate analysis for both documents
                await analyzeDocument('cv', cleanCvContent);
                await analyzeDocument('coverLetter', cleanCoverLetterContent);

                // Show analysis sections
                document.getElementById('cvAnalysis').style.display = 'block';
                document.getElementById('coverLetterAnalysis').style.display = 'block';

                // Show interview prep elements
                const interviewBtn = document.querySelector('.floating-interview-btn');
                const notification = document.getElementById('aiNotification');
                
                if (interviewBtn && notification) {
                    interviewBtn.style.display = 'flex';
                    interviewBtn.classList.add('show', 'pulse');
                    
                    setTimeout(() => {
                        notification.classList.add('show');
                        setTimeout(() => {
                            notification.classList.remove('show');
                            interviewBtn.classList.remove('pulse');
                        }, 3000);
                    }, 500);
                }

                // Generate email
                await generateEmail();

            } catch (error) {
                console.error('Error:', error);
                document.getElementById('cvOutput').innerHTML = 'Error generating CV: ' + error.message;
                document.getElementById('coverLetterOutput').innerHTML = 'Error generating cover letter: ' + error.message;
            }
        }

        async function analyzeDocument(docType, content) {
            const analysisContentId = docType === 'cv' ? 'cvAnalysisContent' : 'coverLetterAnalysisContent';
            const analysisDiv = document.getElementById(analysisContentId);
            analysisDiv.innerHTML = '<div class="loading"><div class="loading-spinner"></div></div>';
            
            try {
                // Use the same API format as the successful email generation
                const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-pro:generateContent?key=${GEMINI_API_KEY}`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        contents: [{
                            parts: [{
                                text: `Analyze this ${docType === 'cv' ? 'CV' : 'cover letter'} and provide a detailed strength analysis.
                                Document: ${content}
                                Job Description: ${jobDescription}
                                
                                Format the analysis with these sections and scores out of 100:
                                1. Relevance to Job Description
                                2. Professional Experience and Achievements
                                3. Skills and Competency
                                4. Career Progression and Impact
                                5. ATS Compatibility
                                6. Structure and Clarity
                                7. Professional Presentation
                                8. Personal Branding and Professional Summary

                                Use this HTML format for each section:
                                <div class="analysis-item">
                                    <h4>[Section Name]</h4>
                                    <p>Score: [X]%</p>
                                    <p>[Brief analysis]</p>
                                </div>`
                            }]
                        }]
                    })
                });

                if (!response.ok) throw new Error('Analysis failed');
                const data = await response.json();
                const analysisText = data.candidates[0].content.parts[0].text;
                analysisDiv.innerHTML = analysisText;

                // Generate suggestions using the same API format
                const suggestionResponse = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-pro:generateContent?key=${GEMINI_API_KEY}`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        contents: [{
                            parts: [{
                                text: `Based on this analysis: ${analysisText}
                                Provide specific suggestions to improve the ${docType === 'cv' ? 'CV' : 'cover letter'}.
                                Format as a clear, actionable paragraph.`
                            }]
                        }]
                    })
                });

                if (!suggestionResponse.ok) throw new Error('Failed to generate suggestions');
                const suggestionData = await suggestionResponse.json();
                const suggestions = suggestionData.candidates[0].content.parts[0].text;
                
                // Add suggestions to the analysis
                analysisDiv.innerHTML += `
                    <div class="analysis-item">
                        <h4>Suggestions for Improvement</h4>
                        <p id="${docType}Suggestions">${suggestions}</p>
                    </div>
                    <button class="nav-btn" onclick="regenerate${docType === 'cv' ? 'Cv' : 'CoverLetter'}()">Improve</button>`;

            } catch (error) {
                console.error('Error:', error);
                analysisDiv.innerHTML = 'Error: ' + error.message;
            }
        }

        async function handleCvUpload() {
            const fileInput = document.getElementById('cvUpload');
            if (!fileInput.files.length) {
                alert('Please select a CV file');
                return;
            }

            const file = fileInput.files[0];
            document.getElementById('cvOutput').innerHTML = '<div class="loading"><div class="loading-spinner"></div></div>';
            
            try {
                cvContent = await extractTextFromPDF(file);
                document.getElementById('cvOutput').textContent = 'CV analyzed successfully!';
            } catch (error) {
                console.error('Error:', error);
                document.getElementById('cvOutput').innerHTML = 'Error: ' + error.message;
            }
        }

        async function regenerateCv() {
            document.getElementById('cvOutput').innerHTML = '<div class="loading"><div class="loading-spinner"></div></div>';
            try {
                const suggestions = document.getElementById('cvSuggestions')?.textContent || '';
                
                // Use the same API format as the successful email generation
                const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-pro:generateContent?key=${GEMINI_API_KEY}`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        contents: [{
                            parts: [{
                                text: `Generate an improved CV based on these guidelines:
                                    Original CV: ${cvContent}
                                    Job Description: ${jobDescription}
                                    Improvement Suggestions: ${suggestions}
                                    
                                    Format with these sections:
                                    1. Header (name and contact)
                                    2. Professional summary
                                    3. Work experience
                                    4. Education
                                    5. Skills
                                    6. Certifications

                                    Use these HTML tags:
                                    - <h2> for section headers
                                    - <ul> and <li> for lists
                                    - <p> for paragraphs
                                    - <strong> for emphasis

                                    Make it professional, ATS-friendly, and targeted to the job description.`
                            }]
                        }]
                    })
                });

                if (!response.ok) throw new Error('Failed to regenerate CV');
                const data = await response.json();
                const newContent = data.candidates[0].content.parts[0].text;
                
                document.getElementById('cvOutput').innerHTML = newContent;
                await analyzeDocument('cv', newContent);
            } catch (error) {
                console.error('Error:', error);
                document.getElementById('cvOutput').innerHTML = 'Error: ' + error.message;
            }
        }

        async function regenerateCoverLetter() {
            document.getElementById('coverLetterOutput').innerHTML = '<div class="loading"><div class="loading-spinner"></div></div>';
            try {
                const suggestions = document.getElementById('coverLetterSuggestions')?.textContent || '';
                
                // Use the same API format as the successful email generation
                const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-pro:generateContent?key=${GEMINI_API_KEY}`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        contents: [{
                            parts: [{
                                text: `Generate an improved cover letter based on these guidelines:
                                    CV Content: ${cvContent}
                                    Job Description: ${jobDescription}
                                    Improvement Suggestions: ${suggestions}
                                    
                                    Include these elements:
                                    1. Current date
                                    2. Recipient's address block
                                    3. Professional salutation
                                    4. Opening paragraph
                                    5. Body paragraphs
                                    6. Closing paragraph
                                    7. Professional closing

                                    Format with HTML:
                                    - Use <p> for paragraphs
                                    - Use <br> for address blocks
                                    
                                    Make it engaging, personalized, and focused on relevant experience.`
                            }]
                        }]
                    })
                });

                if (!response.ok) throw new Error('Failed to regenerate cover letter');
                const data = await response.json();
                const newContent = data.candidates[0].content.parts[0].text;
                
                document.getElementById('coverLetterOutput').innerHTML = newContent;
                await analyzeDocument('coverLetter', newContent);
            } catch (error) {
                console.error('Error:', error);
                document.getElementById('coverLetterOutput').innerHTML = 'Error: ' + error.message;
            }
        }

        async function generateInterviewPrep() {
            const chatMessages = document.getElementById('chatMessages');
            chatMessages.innerHTML = `
                <div class="chat-message">
                    <div class="bot-message">
                        Hello! I'm your AI interview coach. I'll be conducting a mock interview based on the position you're applying for. Ready to begin?
                        <div class="options-container">
                            <button class="option-button" onclick="startInterview('full')">Start Full Interview</button>
                            <button class="option-button" onclick="selectTopic('technical')">Technical Questions</button>
                            <button class="option-button" onclick="selectTopic('behavioral')">Behavioral Questions</button>
                            <button class="option-button" onclick="selectTopic('situational')">Situational Questions</button>
                        </div>
                    </div>
                </div>
            `;
        }

        async function regenerateInterviewPrep() {
            await generateInterviewPrep();
        }

        async function generateEmail() {
            const emailOutput = document.getElementById('emailOutput');
            emailOutput.innerHTML = '<div class="loading"><div class="loading-spinner"></div></div>';

            try {
                const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-pro:generateContent?key=${GEMINI_API_KEY}`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        contents: [{
                            parts: [{
                                text: `Generate a professional outreach email based on this job description and CV. The email should:
                                
1. Be concise and engaging
2. Reference specific details from the job posting
3. Highlight relevant experience from the CV
4. Include a clear call to action

Format the email with proper HTML structure:
- Use <div class="email-header"> for subject line
- Use <div class="email-field"> for To/From fields
- Use <div class="email-body"> for main content

Job Description: ${jobDescription}
CV Content: ${cvContent}

Make it professional, personable, and focused on value proposition.`
                            }]
                        }]
                    })
                });

                if (!response.ok) {
                    throw new Error('Failed to generate email content');
                }

                const data = await response.json();
                emailOutput.innerHTML = data.candidates[0].content.parts[0].text;
            } catch (error) {
                console.error('Error:', error);
                emailOutput.innerHTML = 'Error generating email: ' + error.message;
            }
        }

        async function regenerateEmail() {
            await generateEmail();
        }

        function copyEmail() {
            const emailContent = document.getElementById('emailOutput').innerText;
            navigator.clipboard.writeText(emailContent)
                .then(() => alert('Email copied to clipboard!'))
                .catch(err => console.error('Failed to copy email:', err));
        }

        function toggleEdit(elementId) {
            const element = document.getElementById(elementId);
            const isEditable = element.contentEditable === 'true';
            
            if (isEditable) {
                // Save mode
                element.contentEditable = 'false';
                element.classList.remove('editable');
                // Save the content for analysis
                const content = element.innerHTML;
                if (elementId === 'cvOutput') {
                    analyzeDocument('cv', content);
                } else if (elementId === 'coverLetterOutput') {
                    analyzeDocument('coverLetter', content);
                }
            } else {
                // Edit mode
                element.contentEditable = 'true';
                element.classList.add('editable');
            }

            // Toggle button text
            const button = event.target;
            button.textContent = isEditable ? `Edit ${elementId === 'cvOutput' ? 'CV' : 'Cover Letter'}` : 'Save Changes';
        }

        // Event Listeners
        document.getElementById('cvUpload').addEventListener('change', handleCvUpload);
        document.getElementById('jobDescription').addEventListener('input', (e) => {
            jobDescription = e.target.value;
        });

        // Initialize first section
        updateProgressBar();

        function showSection(sectionId) {
            // Hide all sections
            document.querySelectorAll('.form-section').forEach(section => {
                section.classList.remove('active');
            });

            // Show the selected section
            document.getElementById(sectionId).classList.add('active');

            // Update progress bar
            currentStep = parseInt(document.getElementById(sectionId).dataset.step);
            updateProgressBar();
        }

        function updateProgressBar() {
            document.querySelectorAll('.progress-step').forEach((step, index) => {
                step.classList.toggle('active', index + 1 === currentStep);
                step.classList.toggle('completed', index + 1 < currentStep);
            });
        }

        function toggleInterviewPrep() {
            const section = document.querySelector('.interview-prep-section');
            const button = document.querySelector('.floating-interview-btn');
            
            section.classList.toggle('active');
            button.classList.toggle('active');
            
            if (section.classList.contains('active')) {
                button.style.transform = 'scale(0.95)';
            } else {
                button.style.transform = '';
            }
            
            document.body.style.overflow = section.classList.contains('active') ? 'hidden' : '';
        }

        function selectTopic(topic) {
            const messages = {
                technical: "Let's practice technical questions. Here's your first question:",
                behavioral: "Let's work on behavioral questions using the STAR method. Here's your first question:",
                situational: "Let's discuss some situational scenarios. Here's your first case:",
                'talking-points': "Here are the key points you should emphasize in your interview:"
            };
            
            addMessage(messages[topic], 'bot');
            generateQuestionForTopic(topic);
        }

        function addMessage(text, sender) {
            const messagesDiv = document.getElementById('chatMessages');
            const messageDiv = document.createElement('div');
            messageDiv.className = 'chat-message';
            messageDiv.innerHTML = `<div class="${sender}-message">${text}</div>`;
            messagesDiv.appendChild(messageDiv);
            messagesDiv.scrollTop = messagesDiv.scrollHeight;
        }

        async function generateQuestionForTopic(topic) {
            const prompt = `Based on this CV: ${cvContent} and job description: ${jobDescription}, generate a ${topic} interview question and its ideal answer.`;
            
            try {
                const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-pro:generateContent?key=${GEMINI_API_KEY}`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        contents: [{
                            parts: [{
                                text: prompt
                            }]
                        }]
                    })
                });

                if (!response.ok) throw new Error('Failed to generate question');
                
                const data = await response.json();
                const content = data.candidates[0].content.parts[0].text;
                addMessage(content, 'bot');
            } catch (error) {
                console.error('Error:', error);
                addMessage('Sorry, I had trouble generating a question. Please try again.', 'bot');
            }
        }

        function handleKeyPress(event) {
            if (event.key === 'Enter') {
                sendMessage();
            }
        }

        async function sendMessage() {
            const input = document.getElementById('userInput');
            const message = input.value.trim();
            if (!message) return;

            addMessage(message, 'user');
            input.value = '';

            try {
                const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-pro:generateContent?key=${GEMINI_API_KEY}`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        contents: [{
                            parts: [{
                                text: `As an interview coach, respond to this interview practice answer. Context - CV: ${cvContent}, Job Description: ${jobDescription}, User's answer: ${message}`
                            }]
                        }]
                    })
                });

                if (!response.ok) throw new Error('Failed to get response');
                
                const data = await response.json();
                const content = data.candidates[0].content.parts[0].text;
                addMessage(content, 'bot');
            } catch (error) {
                console.error('Error:', error);
                addMessage('Sorry, I had trouble responding. Please try again.', 'bot');
            }
        }

        let interviewMode = 'practice';
        let currentQuestion = '';
        let questionHistory = [];
        let interviewContext = {
            role: '',
            stage: 'intro',
            score: 0,
            feedback: []
        };

        function setInterviewMode(mode) {
            interviewMode = mode;
            document.querySelectorAll('.role-btn').forEach(btn => {
                btn.classList.toggle('active', btn.textContent.toLowerCase().includes(mode));
            });
            addMessage(`Switched to ${mode} mode. ${mode === 'practice' ? 'I will act as the interviewer.' : 'I will provide detailed feedback on your answers.'}`, 'bot');
        }

        async function startInterview(type) {
            interviewContext = {
                role: type,
                stage: 'intro',
                score: 0,
                feedback: []
            };

            const prompt = `You are a professional interviewer conducting a ${type} interview. Based on the job description: ${jobDescription}
                           and the candidate's CV: ${cvContent}, introduce yourself naturally and ask your first question.
                           Important guidelines:
                           - Be warm and professional
                           - Speak in a natural, conversational tone
                           - Avoid using asterisks or special formatting
                           - Ask one clear question at a time
                           - Keep responses concise and engaging
                           - Match the formality level of a real interview`;

            addTypingIndicator();
            try {
                const response = await getAIResponse(prompt);
                removeTypingIndicator();
                addMessage(response, 'bot');
                currentQuestion = response;
            } catch (error) {
                removeTypingIndicator();
                addMessage('I apologize, but I seem to be having trouble starting the interview. Shall we try again?', 'bot');
            }
        }

        function addTypingIndicator() {
            const messagesDiv = document.getElementById('chatMessages');
            const typingDiv = document.createElement('div');
            typingDiv.className = 'typing-indicator';
            typingDiv.id = 'typingIndicator';
            typingDiv.innerHTML = `
                Interviewer is typing
                <div class="typing-dots">
                    <div class="typing-dot"></div>
                    <div class="typing-dot"></div>
                    <div class="typing-dot"></div>
                </div>
            `;
            messagesDiv.appendChild(typingDiv);
            messagesDiv.scrollTop = messagesDiv.scrollHeight;
        }

        function removeTypingIndicator() {
            const typingDiv = document.getElementById('typingIndicator');
            if (typingDiv) typingDiv.remove();
        }

        async function getAIResponse(prompt) {
            const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-pro:generateContent?key=${GEMINI_API_KEY}`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    contents: [{
                        parts: [{ text: prompt }]
                    }]
                })
            });

            if (!response.ok) throw new Error('Failed to get response');
            const data = await response.json();
            return data.candidates[0].content.parts[0].text;
        }

        // Modify the existing generateInterviewPrep function
        async function generateInterviewPrep() {
            questionHistory = [];
            interviewContext = {
                role: '',
                stage: 'intro',
                score: 0,
                feedback: []
            };
            
            const chatMessages = document.getElementById('chatMessages');
            chatMessages.innerHTML = `
                <div class="chat-message">
                    <div class="bot-message">
                        Hello! I'm your AI interview coach. I'll be conducting a mock interview based on the position you're applying for. Ready to begin?
                        <div class="options-container">
                            <button class="option-button" onclick="startInterview('full')">Start Full Interview</button>
                            <button class="option-button" onclick="selectTopic('technical')">Technical Questions</button>
                            <button class="option-button" onclick="selectTopic('behavioral')">Behavioral Questions</button>
                            <button class="option-button" onclick="selectTopic('situational')">Situational Questions</button>
                        </div>
                    </div>
                </div>
            `;
        }
    </script>
    <script type="module">
        import { signUp, login, logout, initializeAuth } from './firebaseAuth.js';

        // Authentication state management
        initializeAuth((user) => {
            if (user) {
                document.getElementById('authOverlay').style.display = 'none';
                document.getElementById('logoutBtn').style.display = 'block';
            } else {
                document.getElementById('authOverlay').style.display = 'flex';
                document.getElementById('logoutBtn').style.display = 'none';
            }
        });

        // Authentication functions
        window.handleLogin = async (event) => {
            event.preventDefault();
            const email = document.getElementById('loginEmail').value;
            const password = document.getElementById('loginPassword').value;
            const errorElement = document.getElementById('loginError');
            
            try {
                await login(email, password);
                errorElement.style.display = 'none';
                errorElement.textContent = '';
            } catch (error) {
                errorElement.style.display = 'block';
                errorElement.textContent = error.message;
            }
        };

        window.handleSignup = async (event) => {
            event.preventDefault();
            const email = document.getElementById('signupEmail').value;
            const password = document.getElementById('signupPassword').value;
            const errorElement = document.getElementById('signupError');
            
            try {
                await signUp(email, password);
                errorElement.style.display = 'none';
                errorElement.textContent = '';
            } catch (error) {
                errorElement.style.display = 'block';
                errorElement.textContent = error.message;
            }
        };

        // Replace the existing handleLogout function with this enhanced version
        window.handleLogout = async () => {
            try {
                await logout();
                console.log('Logout successful');
                
                // Reset all form inputs
                document.querySelectorAll('input, textarea').forEach(input => {
                    input.value = '';
                });

                // Reset template selection
                document.querySelectorAll('.template-card').forEach(card => {
                    card.classList.remove('selected');
                });
                selectedTemplate = null;
                document.getElementById('generateBtn').disabled = true;

                // Clear outputs
                document.getElementById('cvOutput').innerHTML = '';
                document.getElementById('coverLetterOutput').innerHTML = '';
                document.getElementById('emailOutput').innerHTML = '';

                // Hide analysis sections
                document.getElementById('cvAnalysis').style.display = 'none';
                document.getElementById('coverLetterAnalysis').style.display = 'none';

                // Reset progress bar and show first section
                currentStep = 1;
                updateProgressBar();
                showSection('cvUploadSection');

                // Reset interview prep
                const interviewBtn = document.querySelector('.floating-interview-btn');
                if (interviewBtn) {
                    interviewBtn.style.display = 'none';
                    interviewBtn.classList.remove('show', 'pulse');
                }

                // Hide interview section if open
                const interviewSection = document.querySelector('.interview-prep-section');
                if (interviewSection) {
                    interviewSection.classList.remove('active');
                }

                // Reset global variables
                cvContent = '';
                jobDescription = '';
                keywords = [];
                matchedKeywords = [];
                keywordMatchScore = 0;
                jobDescriptionWords = [];
                personalizedWords = [];
                personalizationScore = 0;
                atsCompatibilityScore = 0;

                // Show auth overlay
                document.getElementById('authOverlay').style.display = 'flex';
                document.getElementById('logoutBtn').style.display = 'none';

                // Reset to login tab in auth overlay
                switchTab('login');

                // Remove any error messages
                document.querySelectorAll('.error-message').forEach(error => {
                    error.classList.remove('show');
                    error.textContent = '';
                });

                // Optional: Scroll to top
                window.scrollTo({ top: 0, behavior: 'smooth' });

            } catch (error) {
                console.error('Logout error:', error);
                alert('Error during logout: ' + error.message);
            }
        };

        window.switchTab = (tab) => {
            document.querySelectorAll('.auth-tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.auth-form').forEach(f => f.classList.remove('active'));
            
            document.querySelector(`.auth-tab:${tab === 'login' ? 'first-child' : 'last-child'}`).classList.add('active');
            document.getElementById(`${tab}Form`).classList.add('active');
        };

        // Add logout button event listener
        document.getElementById('logoutBtn').addEventListener('click', handleLogout);
    </script>
    <!-- Replace the existing auth overlay with this enhanced version -->
    <div id="authOverlay" class="auth-overlay">
        <div class="auth-container">
            <div class="auth-header">
                <h1>Welcome</h1>
                <p>Sign in to continue to CV & Cover Letter Generator</p>
            </div>
            
            <div class="auth-tabs">
                <div class="auth-tab active" onclick="switchTab('login')">Sign In</div>
                <div class="auth-tab" onclick="switchTab('signup')">Create Account</div>
            </div>
            
            <!-- Login Form -->
            <form id="loginForm" class="auth-form active" onsubmit="handleLogin(event)">
                <div class="input-group">
                    <input type="email" id="loginEmail" placeholder="Email" required>
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z" />
                    </svg>
                </div>
                <div class="input-group">
                    <input type="password" id="loginPassword" placeholder="Password" required>
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z" />
                    </svg>
                </div>
                <p id="loginError" class="error-message"></p>
                <button type="submit" class="auth-btn">Sign In</button>
            </form>
            
            <!-- Enhanced Signup Form -->
            <form id="signupForm" class="auth-form" onsubmit="handleSignup(event)">
                <div class="input-group">
                    <input type="text" id="signupFullName" placeholder="Full Name" required>
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" />
                    </svg>
                </div>
                <div class="input-group">
                    <input type="email" id="signupEmail" placeholder="Email" required>
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z" />
                    </svg>
                </div>
                <div class="input-group">
                    <input type="password" id="signupPassword" placeholder="Password (min. 6 characters)" required minlength="6">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z" />
                    </svg>
                </div>
                <div class="input-group">
                    <input type="password" id="signupConfirmPassword" placeholder="Confirm Password" required>
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
                    </svg>
                </div>
                <div class="tos-group">
                    <label>
                        <input type="checkbox" id="tosCheckbox" required>
                        I agree to the Terms of Service and Privacy Policy
                    </label>
                </div>
                <p id="signupError" class="error-message"></p>
                <button type="submit" class="auth-btn">Create Account</button>
            </form>
        </div>
    </div>

    <!-- Add this JavaScript to enhance error handling -->
    <script>
        function showError(elementId, message) {
            const errorElement = document.getElementById(elementId);
            errorElement.textContent = message;
            errorElement.classList.add('show');
            
            // Hide error after 5 seconds
            setTimeout(() => {
                errorElement.classList.remove('show');
            }, 5000);
        }

        // Update error handling in auth functions
        window.handleLogin = async (event) => {
            event.preventDefault();
            const email = document.getElementById('loginEmail').value;
            const password = document.getElementById('loginPassword').value;
            
            try {
                await login(email, password);
            } catch (error) {
                showError('loginError', error.message);
            }
        };

        window.handleSignup = async (event) => {
            event.preventDefault();
            const fullName = document.getElementById('signupFullName').value;
            const email = document.getElementById('signupEmail').value;
            const password = document.getElementById('signupPassword').value;
            const confirmPassword = document.getElementById('signupConfirmPassword').value;
            const tosChecked = document.getElementById('tosCheckbox').checked;
            
            // Reset previous errors
            document.querySelectorAll('.input-group').forEach(group => {
                group.classList.remove('error');
                const feedback = group.querySelector('.input-feedback');
                if (feedback) feedback.remove();
            });

            try {
                // Validation
                if (password !== confirmPassword) {
                    throw new Error('Passwords do not match');
                }

                if (password.length < 6) {
                    throw new Error('Password must be at least 6 characters');
                }

                if (!tosChecked) {
                    throw new Error('Please agree to the Terms of Service');
                }

                const strengthScore = checkPasswordStrength(password);
                if (strengthScore < 2) {
                    throw new Error('Please use a stronger password');
                }

                // Create user account
                const userCredential = await signUp(email, password);
                
                // Store additional user information in Firestore
                const userInfo = {
                    fullName: fullName,
                    email: email,
                    createdAt: new Date().toISOString(),
                    lastLogin: new Date().toISOString()
                };

                // Clear form and show success message
                document.getElementById('signupForm').reset();
                showSuccess('Account created successfully!');

            } catch (error) {
                showError('signupError', error.message);
                
                // Highlight specific field errors
                if (error.message.includes('password')) {
                    document.getElementById('signupPassword').parentElement.classList.add('error');
                }
                if (error.message.includes('email')) {
                    document.getElementById('signupEmail').parentElement.classList.add('error');
                }
            }
        };

        // Password strength checker
        function checkPasswordStrength(password) {
            let strength = 0;
            if (password.length >= 8) strength++;
            if (password.match(/[a-z]/) && password.match(/[A-Z]/)) strength++;
            if (password.match(/[0-9]/)) strength++;
            if (password.match(/[^a-zA-Z0-9]/)) strength++;
            return strength;
        }

        // Update password strength indicator
        document.getElementById('signupPassword').addEventListener('input', function(e) {
            const password = e.target.value;
            const strength = checkPasswordStrength(password);
            let strengthText = '';
            let strengthClass = '';

            switch(strength) {
                case 0:
                case 1:
                    strengthText = 'Weak password';
                    strengthClass = 'weak';
                    break;
                case 2:
                case 3:
                    strengthText = 'Medium strength password';
                    strengthClass = 'medium';
                    break;
                case 4:
                    strengthText = 'Strong password';
                    strengthClass = 'strong';
                    break;
            }

            let strengthIndicator = this.parentElement.querySelector('.password-strength');
            if (!strengthIndicator) {
                strengthIndicator = document.createElement('div');
                strengthIndicator.className = 'password-strength';
                this.parentElement.appendChild(strengthIndicator);
            }
            strengthIndicator.textContent = strengthText;
            strengthIndicator.className = `password-strength ${strengthClass}`;
        });

        // Success message handler
        function showSuccess(message) {
            const successElement = document.createElement('div');
            successElement.className = 'success-message';
            successElement.textContent = message;
            document.querySelector('.auth-container').appendChild(successElement);
            
            setTimeout(() => {
                successElement.remove();
                switchTab('login');
            }, 2000);
        }
    </script>
</body>
</html>


